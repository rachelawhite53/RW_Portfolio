<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Swirling Jet Calculator — Flow Analysis Tool</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  window.MathJax = {
    tex: { inlineMath: [['$', '$'], ['\\(', '\\)']], packages: {'[+]': ['ams']} },
    options: { skipHtmlTags: ['script','style','textarea','pre','code'] }
  };
</script>
<script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

<style>
  :root{
    --bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    --card: #ffffff;
    --card-hover: #f8fafc;
    --text-primary: #1e293b;
    --text-secondary: #64748b;
    --accent: #0ea5e9;
    --accent-hover: #0284c7;
    --orange: #f97316;
    --orange-light: #fed7aa;
    --blue: #3b82f6;
    --blue-light: #dbeafe;
    --green: #10b981;
    --green-light: #d1fae5;
    --border: #e2e8f0;
    --shadow: 0 10px 40px rgba(0, 0, 0, 0.12);
  }
  
  * { box-sizing: border-box; }
  
  body {
    font-family: 'Inter', system-ui, -apple-system, sans-serif;
    background: var(--bg);
    color: var(--text-primary);
    margin: 0;
    padding: 40px 20px;
    min-height: 100vh;
  }
  
  .wrap {
    max-width: 1100px;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    gap: 32px;
  }
  
  .card {
    background: var(--card);
    border-radius: 20px;
    padding: 32px;
    box-shadow: var(--shadow);
  }
  
  h1 {
    margin: 0 0 8px 0;
    font-size: 28px;
    font-weight: 700;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  
  .small {
    font-size: 14px;
    color: var(--text-secondary);
    line-height: 1.6;
  }
  
  .row {
    display: flex;
    gap: 24px;
    margin-top: 24px;
  }
  
  .col { flex: 1; }
  
  label {
    display: block;
    color: var(--text-primary);
    font-size: 14px;
    font-weight: 600;
    margin-bottom: 10px;
  }
  
  input[type=range] {
    width: 100%;
    cursor: pointer;
  }
  
  input[type=number] {
    width: 100%;
    padding: 12px 16px;
    border-radius: 12px;
    border: 2px solid var(--border);
    font-size: 15px;
    font-weight: 500;
    transition: all 0.2s;
    font-family: 'Inter', sans-serif;
  }
  
  input[type=number]:focus {
    outline: none;
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1);
  }
  
  .stats {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 16px;
    margin-top: 24px;
  }
  
  .stat {
    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
    padding: 20px;
    border-radius: 16px;
    text-align: center;
    border: 2px solid var(--border);
  }
  
  .stat .num {
    font-weight: 700;
    font-size: 32px;
    margin-top: 8px;
    letter-spacing: -0.5px;
  }
  
  .btn {
    background: linear-gradient(135deg, var(--accent) 0%, var(--accent-hover) 100%);
    color: white;
    padding: 12px 24px;
    border-radius: 12px;
    border: none;
    cursor: pointer;
    font-weight: 600;
    font-size: 14px;
    transition: all 0.2s;
    box-shadow: 0 4px 12px rgba(14, 165, 233, 0.3);
  }
  
  .btn:hover { transform: translateY(-2px); }
  
  .btn.green {
    background: linear-gradient(135deg, var(--green) 0%, #059669 100%);
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
  }
  
  a.link {
    color: var(--accent);
    text-decoration: none;
    font-size: 14px;
    font-weight: 600;
  }
  
  canvas {
    width: 100% !important;
    height: 240px !important;
    border-radius: 12px;
  }
  
  .math-notes {
    background: linear-gradient(135deg, #fafbfc 0%, #f8fafc 100%);
    border: 2px solid var(--border);
    padding: 32px;
    border-radius: 16px;
    margin-top: 24px;
  }
  
  .analysis-grid {
    display: grid;
    gap: 20px;
    margin-top: 32px;
  }
  
  .analysis-section {
    background: white;
    border: 2px solid var(--border);
    border-radius: 12px;
    padding: 20px;
  }
  
  .analysis-section.highlight {
    background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
    border-color: var(--blue);
  }
  
  .section-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 16px;
  }
  
  .section-number {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
    background: linear-gradient(135deg, var(--accent) 0%, var(--blue) 100%);
    color: white;
    border-radius: 8px;
    font-weight: 700;
    font-size: 16px;
    flex-shrink: 0;
  }
  
  .analysis-section h4 { margin: 0; font-size: 18px; }
  
  .math-notes .eq {
    margin: 14px 0;
    padding: 20px;
    border-radius: 10px;
    background: #ffffff;
    border: 2px solid var(--border);
    overflow-x: auto;
    box-shadow: 0 4px 12px rgba(0,0,0,0.05);
  }
  
  .key-eq {
    background: #ffffff !important;
    border-color: var(--text-primary) !important;
    font-weight: 500;
  }
  
  .input-grid {
    margin-top: 20px;
    display: grid;
    grid-template-columns: 1fr 1fr 220px;
    gap: 24px;
    align-items: start;
  }
  
  .input-group { display: flex; flex-direction: column; gap: 16px; }
  .dual-input { display: flex; gap: 12px; }
  .dual-input input { width: 90px; }
  
  .controls {
    display: flex; gap: 12px; align-items: center; margin-top: 20px;
  }

  .correction-note {
    background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
    border: 2px solid #f59e0b;
    padding: 16px;
    border-radius: 12px;
    margin-top: 20px;
    font-size: 13px;
    line-height: 1.6;
  }

  .correction-note strong {
    color: #92400e;
    display: block;
    margin-bottom: 8px;
    font-size: 14px;
  }
  
  @media (max-width: 768px) {
    .wrap { padding: 20px 16px; }
    .card { padding: 24px; }
    .row { flex-direction: column; }
    .stats { grid-template-columns: 1fr; }
    .input-grid { grid-template-columns: 1fr; }
  }
</style>
</head>
<body>
  <div class="wrap">

    <div class="card" id="calculatorCard">
      <div>
        <h1>Swirling Jet: Parameter Calculator</h1>
      </div>

      <div class="row">
        <div class="col">
          <label for="axial">Axial Flow $Q_{ax}$</label>
          <input id="axial" type="range" min="0" max="200" value="0" step="0.1" />
          <div class="small" style="margin-top:12px">Value: <span id="axialVal" class="value-display">0</span> GPM</div>
        </div>
        <div class="col">
          <label for="tangential">Tangential Flow $Q_{tan}$</label>
          <input id="tangential" type="range" min="0" max="200" value="0" step="0.1" />
          <div class="small" style="margin-top:12px">Value: <span id="tanVal" class="value-display">0</span> GPM</div>
        </div>
      </div>

      <div class="stats">
        <div class="stat">
          <div class="small">Swirl Number (S)</div>
          <div id="S" class="num" style="color:var(--orange)">0.00</div>
        </div>
        <div class="stat">
          <div class="small">Reynolds Number (Re)</div>
          <div id="Re" class="num" style="color:var(--blue)">0</div>
        </div>
        <div class="stat">
          <div class="small">Total Flow</div>
          <div id="Qtot" class="num" style="color:var(--green)">0 GPM</div>
        </div>
      </div>

      <div class="stats" style="margin-top:16px; grid-template-columns: repeat(2, 1fr);">
        <div class="stat">
          <div class="small">Nozzle Area (A<sub>N</sub>)</div>
          <div id="AN" class="num" style="color:var(--blue); font-size:24px;">0 mm²</div>
        </div>
        <div class="stat">
          <div class="small">Total Inlet Area (A<sub>2</sub>)</div>
          <div id="A2" class="num" style="color:var(--orange); font-size:24px;">0 mm²</div>
        </div>
      </div>

      <div style="margin-top:28px; display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
        <div>
          <h4 style="text-align:center; margin-bottom:12px; font-size:16px;">Parametric Variation: S & Re vs Qax (Qtan fixed at <span id="qtanLabel">0</span> GPM)</h4>
          <canvas id="chartD2"></canvas>
        </div>
        <div>
          <h4 style="text-align:center; margin-bottom:12px; font-size:16px;">Parametric Variation: S & Re vs Qtan (Qax fixed at <span id="qaxLabel">0</span> GPM)</h4>
          <canvas id="chartDN"></canvas>
        </div>
      </div>
    </div>

    <div class="card" id="stepsCard">
      <div>
        <h1>Manual Input — Targets & Geometry</h1>
        <div class="small">Enter specific flow rates and geometry parameters as needed.</div>
      </div>

      <div class="input-grid">
        <div class="input-group">
          <div>
            <label>Axial Flow (GPM)</label>
            <input id="qax" type="number" value="0" step="0.1" />
          </div>
          <div>
            <label>Tangential Flow (GPM)</label>
            <input id="qtan" type="number" value="0" step="0.1" />
          </div>
        </div>

        <div class="input-group">
          <div>
            <label>Nozzle diameter $D_N$ (mm)</label>
            <input id="dn" type="number" value="10" step="0.01" style="width:140px" />
          </div>
          <div>
            <label>Swirler inlet diameter $D_2$ (mm)</label>
            <input id="d1" type="number" value="70" step="0.01" style="width:140px" />
          </div>
        </div>

        <div class="input-group">
          <div>
            <label>Number of tangential inlets ($n$)</label>
            <input id="nInlets" type="number" value="4" min="1" step="1" style="width:140px" />
          </div>
          <div>
            <label>Inlet height (h) and width (b) (mm)</label>
            <div class="dual-input" style="margin-top:8px">
              <input id="h" type="number" value="7.5" step="0.01" />
              <input id="b" type="number" value="8.061" step="0.001" />
            </div>
          </div>
        </div>
      </div>

      <div class="controls" style="margin-top:18px;">
        <button id="compute" class="btn">Update Calculations</button>
      </div>

      <hr />

      <div class="math-notes" style="margin-top:18px;">
        <h3>Target-driven calculations</h3>
        <div class="analysis-grid">
          <div class="analysis-section">
            <div class="section-header">
              <span class="section-number">1</span>
              <h4>Target Reynolds Number</h4>
            </div>
            <p>Enter target Re to solve for the required axial flow rate.</p>
            <div style="display:grid; gap:12px; margin-top:12px;">
              <div>
                <label style="font-size:13px; font-weight:600;">Target Re</label>
                <input id="targetRe" type="number" placeholder="e.g. 20000" step="1" style="margin-top:4px;" />
              </div>
              <button id="applyRe" class="btn">Compute Q<sub>ax</sub></button>
              <div id="reResult" class="small" style="color:var(--text-secondary); min-height:20px;"></div>
            </div>
          </div>

          <div class="analysis-section highlight">
            <div class="section-header">
              <span class="section-number">2</span>
              <h4>Target Swirl Number</h4>
            </div>
            <p>Enter target S and one flow rate to solve for the other.</p>
            <div style="display:grid; gap:12px; margin-top:12px;">
              <div>
                <label style="font-size:13px; font-weight:600;">Target S</label>
                <input id="targetS" type="number" placeholder="e.g. 0.8" step="0.01" style="margin-top:4px;" />
              </div>
              <div>
                <label style="font-size:13px; font-weight:600;">Known Flow</label>
                <select id="knownFlow" style="padding:10px; border-radius:8px; border:2px solid var(--border); margin-top:4px;">
                  <option value="qax">Q<sub>ax</sub> is known (solve for Q<sub>tan</sub>)</option>
                  <option value="qtan">Q<sub>tan</sub> is known (solve for Q<sub>ax</sub>)</option>
                </select>
              </div>
              <div>
                <label style="font-size:13px; font-weight:600;">Known Flow Value (GPM)</label>
                <input id="knownFlowValue" type="number" placeholder="e.g. 15" step="0.1" style="margin-top:4px;" />
              </div>
              <button id="applyS" class="btn">Compute Unknown Flow</button>
              <div id="sResult" class="small" style="color:var(--text-secondary); min-height:20px;"></div>
            </div>
          </div>

          <div class="analysis-section">
            <div class="section-header">
              <span class="section-number">3</span>
              <h4>Target Total Flow</h4>
            </div>
            <p>Enter target Q<sub>total</sub> and target S to solve for Q<sub>ax</sub> and Q<sub>tan</sub>.</p>
            <div style="display:grid; gap:12px; margin-top:12px;">
              <div>
                <label style="font-size:13px; font-weight:600;">Target Q<sub>total</sub> (GPM)</label>
                <input id="targetQtotal" type="number" placeholder="e.g. 25" step="0.1" style="margin-top:4px;" />
              </div>
              <div>
                <label style="font-size:13px; font-weight:600;">Target S</label>
                <input id="targetSforQtotal" type="number" placeholder="e.g. 0.8" step="0.01" style="margin-top:4px;" />
              </div>
              <button id="applyQtotal" class="btn">Compute Q<sub>ax</sub> & Q<sub>tan</sub></button>
              <div id="qtotalResult" class="small" style="color:var(--text-secondary); min-height:20px;"></div>
            </div>
          </div>
        </div>
      </div>

      <hr />

      <div class="math-notes">
        <div style="text-align:center; margin-bottom:16px; color:var(--text-secondary); font-weight:600; font-size:14px; text-transform:uppercase; letter-spacing:1px;"> 
          Fundamental Equations
        </div>
        
        <div style="background: white; padding: 24px; border-radius: 12px; border: 2px solid var(--border); margin-bottom: 20px;">
          <h4 style="margin-top: 0; color: var(--text-primary); font-size: 16px;">Total Volumetric Flow Rate</h4>
          <div class="eq" style="text-align:center; font-size:1.1em;">
            \[ Q = Q_{ax} + Q_{tan} \]
          </div>
        </div>

        <div style="background: white; padding: 24px; border-radius: 12px; border: 2px solid var(--border); margin-bottom: 20px;">
          <h4 style="margin-top: 0; color: var(--text-primary); font-size: 16px;">Flow Components</h4>
          <div class="eq" style="text-align:center; font-size:1.1em;">
            \[ Q_{ax} = A_N \bar{v}_{N,ax}, \quad Q_{tan} = A_2 \bar{v}_{2,\theta} \]
          </div>
        </div>

        <div style="background: white; padding: 24px; border-radius: 12px; border: 2px solid var(--border);">
          <h4 style="margin-top: 0; color: var(--text-primary); font-size: 16px;">Cross-Sectional Areas</h4>
          <div class="eq" style="text-align:center; font-size:1.1em;">
            \[ A_N = \frac{\pi}{4}D_N^2, \quad A_2 = n(bh) \]
          </div>
          <p style="text-align:center; color:var(--text-secondary); font-size:13px; margin-top:12px; margin-bottom:0;">
            where $n$ is the number of tangential inlets
          </p>
        </div>
      </div>

      <hr />

      <div class="math-notes">
        <div style="text-align:center; margin-bottom:16px; color:var(--text-secondary); font-weight:600; font-size:14px; text-transform:uppercase; letter-spacing:1px;"> 
          Governing Equation
        </div>
        <div class="eq key-eq" style="text-align:center; font-size:1.3em; padding:32px;">
            \[ \overline{V}_{\theta,N} = \dfrac{3n D_2 \overline{V}_{\theta,2}}{\pi D_N^2} \]
        </div>
        <p style="text-align:center; color:var(--text-secondary); font-size:13px; margin-top:16px;">
          Derived from conservation of angular momentum between the swirler inlet and nozzle exit.
        </p>
      </div>

    </div>
  </div>

<script>
const RHO = 996.3;
const MU  = 8.345e-4;
const GPM_TO_M3S = 6.30902e-5;
const MM_TO_M = 0.001;

const axial = document.getElementById('axial');
const tang = document.getElementById('tangential');
const axialVal = document.getElementById('axialVal');
const tanVal = document.getElementById('tanVal');
const Sdisp = document.getElementById('S');
const Redisp = document.getElementById('Re');
const QtotDisp = document.getElementById('Qtot');
const ANdisp = document.getElementById('AN');
const A2disp = document.getElementById('A2');

const qaxEl = document.getElementById('qax');
const qtanEl = document.getElementById('qtan');
const dnEl = document.getElementById('dn');
const d1El = document.getElementById('d1');
const nInletsEl = document.getElementById('nInlets');
const hEl = document.getElementById('h');
const bEl = document.getElementById('b');

const targetReEl = document.getElementById('targetRe');
const applyReBtn = document.getElementById('applyRe');
const reResult = document.getElementById('reResult');

const targetSEl = document.getElementById('targetS');
const knownFlowEl = document.getElementById('knownFlow');
const knownFlowValueEl = document.getElementById('knownFlowValue');
const applySBtn = document.getElementById('applyS');
const sResult = document.getElementById('sResult');

const targetQtotalEl = document.getElementById('targetQtotal');
const targetSforQtotalEl = document.getElementById('targetSforQtotal');
const applyQtotalBtn = document.getElementById('applyQtotal');
const qtotalResult = document.getElementById('qtotalResult');

const ctxD2 = document.getElementById('chartD2').getContext('2d');
const ctxDN = document.getElementById('chartDN').getContext('2d');

const chartD2 = new Chart(ctxD2, {
  type: 'line',
  data: {
    labels: [],
    datasets: [
      {
        label: 'Q_ax',
        data: [],
        borderColor: '#3b82f6',
        backgroundColor: 'rgba(59, 130, 246, 0.1)',
        borderWidth: 3,
        tension: 0.4
      },
      {
        label: 'Q_tan',
        data: [],
        borderColor: '#f97316',
        backgroundColor: 'rgba(249, 115, 22, 0.1)',
        borderWidth: 3,
        tension: 0.4
      }
    ]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    scales: {
      y: { beginAtZero: true, title: { display: true, text: 'Flow (GPM)' } },
      x: { title: { display: true, text: 'D₂ (mm)' } }
    },
    plugins: {
      legend: { display: true, position: 'top' }
    }
  }
});

const chartDN = new Chart(ctxDN, {
  type: 'line',
  data: {
    labels: [],
    datasets: [
      {
        label: 'Q_ax',
        data: [],
        borderColor: '#3b82f6',
        backgroundColor: 'rgba(59, 130, 246, 0.1)',
        borderWidth: 3,
        tension: 0.4
      },
      {
        label: 'Q_tan',
        data: [],
        borderColor: '#f97316',
        backgroundColor: 'rgba(249, 115, 22, 0.1)',
        borderWidth: 3,
        tension: 0.4
      }
    ]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    scales: {
      y: { beginAtZero: true, title: { display: true, text: 'Flow (GPM)' } },
      x: { title: { display: true, text: 'D_N (mm)' } }
    },
    plugins: {
      legend: { display: true, position: 'top' }
    }
  }
});

function computePhysics(qAxGpm, qTanGpm, dN_mm, d1_mm, nInlets, h_mm, b_mm) {
  const qAx = +qAxGpm, qTan = +qTanGpm;
  const qTotGpm = qAx + qTan;
  
  const dN_m = dN_mm * MM_TO_M;
  const d1_m = d1_mm * MM_TO_M;
  const h_m = h_mm * MM_TO_M;
  const b_m = b_mm * MM_TO_M;
  
  const A_n = Math.PI * Math.pow(dN_m / 2, 2);
  const A2 = Math.max(0, nInlets * (b_m * h_m));
  
  const Qax_m3s = qAx * GPM_TO_M3S;
  const Qtan_m3s = qTan * GPM_TO_M3S;
  
  const vN_ax = A_n > 0 ? Qax_m3s / A_n : 0;
  const v2_theta = A2 > 0 ? Qtan_m3s / A2 : 0;
  
  const vN_theta = dN_m > 0 ? (3 * nInlets * d1_m * v2_theta) / (Math.PI * dN_m * dN_m) : 0;
  
  let S;
  if (vN_ax === 0 && vN_theta === 0) S = 0;
  else if (vN_ax === 0) S = Infinity;
  else S = vN_theta / vN_ax;
  
  const Re = A_n > 0 ? (RHO * vN_ax * dN_m) / MU : 0;
  
  return { qAx, qTan, qTotGpm, vN_ax, v2_theta, vN_theta, S, Re, A_n, A2, dN_m, d1_m };
}

function calcQaxForRe(targetRe, dN_mm, A_n) {
  const dN_m = dN_mm * MM_TO_M;
  if (!A_n || dN_m <= 0) return { error: 'Invalid geometry' };
  const vN_ax = (targetRe * MU) / (RHO * dN_m);
  const Qax_m3s = vN_ax * A_n;
  return { Qax_gpm: Qax_m3s / GPM_TO_M3S };
}

function calcQtanForS(targetS, qAx_gpm, A_n, A2, dN_m, d1_m, nInlets) {
  if (!A2 || !A_n || dN_m <= 0) return { error: 'Invalid geometry' };
  const Qax_m3s = qAx_gpm * GPM_TO_M3S;
  const vN_ax = Qax_m3s / A_n;
  
  const vN_theta_target = targetS * vN_ax;
  const v2_theta = (vN_theta_target * Math.PI * dN_m * dN_m) / (3 * nInlets * d1_m);
  const Qtan_m3s = v2_theta * A2;
  
  return { Qtan_gpm: Qtan_m3s / GPM_TO_M3S };
}

function calcQaxForS(targetS, qTan_gpm, A_n, A2, dN_m, d1_m, nInlets) {
  if (!A2 || !A_n || dN_m <= 0 || targetS === 0) return { error: 'Invalid input' };
  const Qtan_m3s = qTan_gpm * GPM_TO_M3S;
  const v2_theta = Qtan_m3s / A2;
  
  const vN_theta = (3 * nInlets * d1_m * v2_theta) / (Math.PI * dN_m * dN_m);
  const vN_ax = vN_theta / targetS;
  const Qax_m3s = vN_ax * A_n;
  
  return { Qax_gpm: Qax_m3s / GPM_TO_M3S };
}

function updateCharts() {
  const qAx = parseFloat(axial.value);
  const qTan = parseFloat(tang.value);
  const dN = parseFloat(dnEl.value) || 10;
  const d1 = parseFloat(d1El.value) || 70;
  const n = parseFloat(nInletsEl.value) || 4;
  const h = parseFloat(hEl.value) || 7.5;
  const b = parseFloat(bEl.value) || 8.061;

  const qaxRange = [];
  const sVsQax = [];
  const reVsQax = [];
  
  for (let q = 0; q <= 100; q += 2) {
    qaxRange.push(q.toFixed(0));
    const res = computePhysics(q, qTan, dN, d1, n, h, b);
    sVsQax.push(isFinite(res.S) && res.S < 1000 ? res.S : null);
    reVsQax.push(res.Re / 1000);
  }

  chartD2.data.labels = qaxRange;
  chartD2.data.datasets[0].data = sVsQax;
  chartD2.data.datasets[0].label = 'Swirl Number (S)';
  chartD2.data.datasets[0].borderColor = '#f97316';
  chartD2.data.datasets[0].backgroundColor = 'rgba(249, 115, 22, 0.1)';
  chartD2.data.datasets[1].data = reVsQax;
  chartD2.data.datasets[1].label = 'Re (×1000)';
  chartD2.data.datasets[1].borderColor = '#3b82f6';
  chartD2.data.datasets[1].backgroundColor = 'rgba(59, 130, 246, 0.1)';
  chartD2.options.scales.y.title.text = 'S / Re(×1000)';
  chartD2.options.scales.x.title.text = 'Q_ax (GPM)';
  chartD2.update();

  const qtanRange = [];
  const sVsQtan = [];
  const reVsQtan = [];
  
  for (let q = 0; q <= 100; q += 2) {
    qtanRange.push(q.toFixed(0));
    const res = computePhysics(qAx, q, dN, d1, n, h, b);
    sVsQtan.push(isFinite(res.S) && res.S < 1000 ? res.S : null);
    reVsQtan.push(res.Re / 1000);
  }

  chartDN.data.labels = qtanRange;
  chartDN.data.datasets[0].data = sVsQtan;
  chartDN.data.datasets[0].label = 'Swirl Number (S)';
  chartDN.data.datasets[0].borderColor = '#f97316';
  chartDN.data.datasets[0].backgroundColor = 'rgba(249, 115, 22, 0.1)';
  chartDN.data.datasets[1].data = reVsQtan;
  chartDN.data.datasets[1].label = 'Re (×1000)';
  chartDN.data.datasets[1].borderColor = '#3b82f6';
  chartDN.data.datasets[1].backgroundColor = 'rgba(59, 130, 246, 0.1)';
  chartDN.options.scales.y.title.text = 'S / Re(×1000)';
  chartDN.options.scales.x.title.text = 'Q_tan (GPM)';
  chartDN.update();
}

function checkSliderRange(slider, val) {
  if (val > parseFloat(slider.max)) {
    slider.max = Math.ceil(val * 1.2);
  }
}

function updateCalculatorUI() {
  const dN = parseFloat(dnEl.value) || 10;
  const d1 = parseFloat(d1El.value) || 70;
  const n = parseFloat(nInletsEl.value) || 4;
  const h = parseFloat(hEl.value) || 7.5;
  const b = parseFloat(bEl.value) || 8.061;

  let qA = parseFloat(axial.value);
  let qT = parseFloat(tang.value);

  const res = computePhysics(qA, qT, dN, d1, n, h, b);

  axialVal.textContent = res.qAx.toFixed(2);
  tanVal.textContent = res.qTan.toFixed(2);
  
  if (document.activeElement !== qaxEl) qaxEl.value = res.qAx.toFixed(3);
  if (document.activeElement !== qtanEl) qtanEl.value = res.qTan.toFixed(3);

  Sdisp.textContent = isFinite(res.S) ? res.S.toFixed(3) : '∞';
  QtotDisp.textContent = res.qTotGpm.toFixed(2) + ' GPM';
  Redisp.textContent = Math.round(res.Re).toLocaleString();
  
  const A_N_mm2 = res.A_n * 1e6;
  const A_2_mm2 = res.A2 * 1e6;
  ANdisp.textContent = A_N_mm2.toFixed(2) + ' mm²';
  A2disp.textContent = A_2_mm2.toFixed(2) + ' mm²';

  document.getElementById('qaxLabel').textContent = res.qAx.toFixed(1);
  document.getElementById('qtanLabel').textContent = res.qTan.toFixed(1);

  updateCharts();
}

axial.addEventListener('input', updateCalculatorUI);
tang.addEventListener('input', updateCalculatorUI);

qaxEl.addEventListener('input', () => {
  const val = parseFloat(qaxEl.value) || 0;
  checkSliderRange(axial, val);
  axial.value = val;
  updateCalculatorUI();
});
qtanEl.addEventListener('input', () => {
  const val = parseFloat(qtanEl.value) || 0;
  checkSliderRange(tang, val);
  tang.value = val;
  updateCalculatorUI();
});

[dnEl, d1El, nInletsEl, hEl, bEl].forEach(el => {
  el.addEventListener('input', updateCalculatorUI);
});

document.getElementById('compute').addEventListener('click', () => {
  const qA = parseFloat(qaxEl.value) || 0;
  const qT = parseFloat(qtanEl.value) || 0;
  checkSliderRange(axial, qA);
  checkSliderRange(tang, qT);
  axial.value = qA;
  tang.value = qT;
  updateCalculatorUI();
});

applyReBtn.addEventListener('click', () => {
  const target = parseFloat(targetReEl.value);
  if (!target || target <= 0) { reResult.textContent = "Invalid Re"; return; }
  
  const dN = parseFloat(dnEl.value) || 10;
  const dN_m = dN * MM_TO_M;
  const A_n = Math.PI * Math.pow(dN_m/2, 2);

  const res = calcQaxForRe(target, dN, A_n);
  if (res.error) { reResult.textContent = res.error; return; }

  checkSliderRange(axial, res.Qax_gpm);
  axial.value = res.Qax_gpm;
  qaxEl.value = res.Qax_gpm.toFixed(3);
  updateCalculatorUI();
  reResult.textContent = `✓ Set Q_ax to ${res.Qax_gpm.toFixed(2)} GPM`;
});

applySBtn.addEventListener('click', () => {
  const targetS = parseFloat(targetSEl.value);
  const knownValue = parseFloat(knownFlowValueEl.value);
  
  if (isNaN(targetS) || targetS < 0) { 
    sResult.textContent = "Invalid S value"; 
    return; 
  }
  if (isNaN(knownValue) || knownValue < 0) { 
    sResult.textContent = "Invalid flow value"; 
    return; 
  }
  
  const dN = parseFloat(dnEl.value)||10, d1 = parseFloat(d1El.value)||70;
  const n = parseFloat(nInletsEl.value)||4, h = parseFloat(hEl.value)||7.5, b = parseFloat(bEl.value)||8.061;
  const dN_m = dN * MM_TO_M, d1_m = d1 * MM_TO_M;
  const A_n = Math.PI * Math.pow(dN_m/2, 2);
  const A2 = n * (h * MM_TO_M) * (b * MM_TO_M);

  const mode = knownFlowEl.value;
  let newQ;

  if (mode === 'qax') {
    const res = calcQtanForS(targetS, knownValue, A_n, A2, dN_m, d1_m, n);
    if (res.error) { sResult.textContent = res.error; return; }
    newQ = res.Qtan_gpm;
    checkSliderRange(tang, newQ);
    tang.value = newQ;
    qtanEl.value = newQ.toFixed(3);
    sResult.textContent = `✓ Set Q_tan to ${newQ.toFixed(2)} GPM (Q_ax = ${knownValue.toFixed(2)} GPM)`;
  } else {
    const res = calcQaxForS(targetS, knownValue, A_n, A2, dN_m, d1_m, n);
    if (res.error) { sResult.textContent = res.error; return; }
    newQ = res.Qax_gpm;
    checkSliderRange(axial, newQ);
    axial.value = newQ;
    qaxEl.value = newQ.toFixed(3);
    sResult.textContent = `✓ Set Q_ax to ${newQ.toFixed(2)} GPM (Q_tan = ${knownValue.toFixed(2)} GPM)`;
  }
  updateCalculatorUI();
});

applyQtotalBtn.addEventListener('click', () => {
  const targetQtot = parseFloat(targetQtotalEl.value);
  const targetS = parseFloat(targetSforQtotalEl.value);
  
  if (isNaN(targetQtot) || targetQtot <= 0) { 
    qtotalResult.textContent = "Invalid Q_total value"; 
    return; 
  }
  if (isNaN(targetS) || targetS < 0) { 
    qtotalResult.textContent = "Invalid S value"; 
    return; 
  }
  
  const dN = parseFloat(dnEl.value)||10, d1 = parseFloat(d1El.value)||70;
  const n = parseFloat(nInletsEl.value)||4, h = parseFloat(hEl.value)||7.5, b = parseFloat(bEl.value)||8.061;
  const dN_m = dN * MM_TO_M, d1_m = d1 * MM_TO_M;
  const A_n = Math.PI * Math.pow(dN_m/2, 2);
  const A2 = n * (h * MM_TO_M) * (b * MM_TO_M);
  
  const Qax_m3s = targetQtot * GPM_TO_M3S / (1 + targetS * A2 * dN_m / (3 * n * d1_m * A_n));
  const Qtan_m3s = targetQtot * GPM_TO_M3S - Qax_m3s;
  
  const Qax_gpm = Qax_m3s / GPM_TO_M3S;
  const Qtan_gpm = Qtan_m3s / GPM_TO_M3S;
  
  if (Qax_gpm < 0 || Qtan_gpm < 0) {
    qtotalResult.textContent = "Solution resulted in negative flow - check inputs";
    return;
  }
  
  checkSliderRange(axial, Qax_gpm);
  checkSliderRange(tang, Qtan_gpm);
  axial.value = Qax_gpm;
  tang.value = Qtan_gpm;
  qaxEl.value = Qax_gpm.toFixed(3);
  qtanEl.value = Qtan_gpm.toFixed(3);
  updateCalculatorUI();
  qtotalResult.textContent = `✓ Q_ax = ${Qax_gpm.toFixed(2)} GPM, Q_tan = ${Qtan_gpm.toFixed(2)} GPM`;
});

updateCalculatorUI();
</script>
</body>
</html>